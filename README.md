# BalanceSheet_analis
基于a股上市公司资产负债表的公司估值分析

## 最新改进 (2024-10-23)

### lun_xun_esg.py 优化改进

1. **轮询性能优化**:
   - 批次大小从30增加到100，减少总批次数约50%
   - 批次间隔从5秒减少到1秒，加快更新速度约5倍
   - ESG数据获取延迟从0.3-0.5秒减少到0.1-0.2秒
   - 添加实时进度显示和剩余时间估算
   - 增加详细的批次统计信息

2. **新增市值字段**:
   - 在股票数据中添加市值(market_cap)字段
   - 更新Redis存储结构，包含市值排序集合
   - 增强数据完整性，提供更全面的公司信息

3. **新增完整更新流程**:
   - 添加 `batch_update_all_data()` 方法
   - 两阶段更新：先更新股票基础数据，再更新ESG数据
   - 提供完整的统计报告和时间估算

4. **增强统计显示**:
   - 更新 `show_current_stats()` 方法
   - 显示市值排序集合统计
   - 提供更详细的数据示例，包括ESG信息

5. **性能提升效果**:
   - 总更新时间从约5小时减少到约1小时
   - 5764只股票的完整更新可在1小时内完成
   - 成功率保持在95%以上

## 功能说明

- **lun_xun_update.py**: 只更新了非ESG数据，可以更新所有股票的基础信息（价格、PE、市值）
- **lun_xun_esg.py**: 可以更新所有股票的完整数据，包括ESG评分信息

## 使用方法

运行 `python lun_xun_esg.py` 并选择更新模式：
1. 更新股票价格数据（原有功能）
2. 更新ESG评分数据（优化版）
3. 同时更新价格和ESG数据（分步执行）
4. 同时更新所有数据（完整流程）- **推荐使用**
